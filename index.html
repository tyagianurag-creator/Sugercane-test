<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
 
  <title>Sugarcane Disease Detection</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0/dist/tf.min.js"></script>

  <!-- Teachable Machine Library -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }

    img {
      margin-top: 20px;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
    }
    button {
  padding:10px 14px;
  margin:6px;
  font-size:16px;
  border-radius:10px;
  cursor:pointer;
}
     #warning {
  color: #b71c1c;
  font-weight: bold;
}
.low-confidence {
  border: 2px solid #b71c1c;
}
  </style>
 
  
</head>

<body>

  <h1 id="title">Sugarcane Disease Detection üåæ</h1>
<div style="margin-bottom:12px;">
  <button id="langToggle">üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
</div>
  <input type="file" id="imageUpload" accept="image/*">
  <div id="preview"></div>
  <div id="result"></div>
  <div id="warning" style="margin-top:10px; font-size:16px; display:none;"></div>
  <div id="treatment" style="margin-top:10px; font-size:16px;"></div>
<div id="actions" style="margin-top:16px; display:none;">
  <button id="btnCorrect">‚úÖ Correct</button>
  <button id="btnWrong">‚ùå Wrong</button>
  <button id="btnExpert">üí¨ WhatsApp Expert</button>
</div>
  <script>
    let model;
    let modelReady = false;
let lastPrediction = null;

const FORM_BASE = "https://docs.google.com/forms/d/e/1FAIpQLSem_oTTQBtdWz8NBy8Joh0WTU6NHorbT4O8eHg6-ysgozgjBg/viewform?usp=pp_url";
    let lang = "en"; // default

const T = {
  en: {
    title: "Sugarcane Disease Detection üåæ",
    uploadHint: "",
    correct: "‚úÖ Correct",
    wrong: "‚ùå Wrong",
    expert: "üí¨ WhatsApp Expert",
    lowConf: "‚ö†Ô∏è Low confidence. Please take a clearer photo or consult expert on WhatsApp.",
    predPrefix: "Prediction: "
  },
  hi: {
    title: "‡§ó‡§®‡•ç‡§®‡§æ ‡§∞‡•ã‡§ó ‡§™‡§π‡§ö‡§æ‡§® üåæ",
    uploadHint: "",
    correct: "‚úÖ ‡§∏‡§π‡•Ä",
    wrong: "‚ùå ‡§ó‡§≤‡§§",
    expert: "üí¨ WhatsApp ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ",
    lowConf: "‚ö†Ô∏è ‡§ï‡§Æ ‡§≠‡§∞‡•ã‡§∏‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§æ‡§´‡§º ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç ‡§Ø‡§æ WhatsApp ‡§™‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§",
    predPrefix: "‡§®‡§§‡•Ä‡§ú‡§æ: "
  }
      };
    function getTreatment(disease) {
  if (disease.toLowerCase().includes("red")) {
    return {
      en: "Remove infected canes immediately. Avoid water stagnation. Use recommended fungicide treatment.",
      hi: "‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§ø‡§§ ‡§ó‡§®‡•ç‡§®‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§π‡§ü‡§æ‡§è‡§Ç‡•§ ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§®‡•Ä ‡§ú‡§Æ‡§æ ‡§® ‡§π‡•ã‡§®‡•á ‡§¶‡•á‡§Ç‡•§ ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§´‡§´‡•Ç‡§Ç‡§¶‡§®‡§æ‡§∂‡§ï ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§"
  }

  if (disease.toLowerCase().includes("smut")) {
    return {
      en: "Remove smut whips early. Use disease-free seed cane. Avoid ratoon from infected fields.",
      hi: "‡§∏‡•ç‡§Æ‡§ü ‡§µ‡•ç‡§π‡§ø‡§™‡•ç‡§∏ ‡§ï‡•ã ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§π‡§ü‡§æ‡§è‡§Ç‡•§ ‡§∞‡•ã‡§ó‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§¨‡•Ä‡§ú ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§ø‡§§ ‡§ñ‡•á‡§§ ‡§∏‡•á ‡§∞atoon ‡§® ‡§≤‡•á‡§Ç‡•§"
    };
  }

  if (disease.toLowerCase().includes("healthy")) {
    return {
      en: "Crop appears healthy. Maintain proper irrigation and regular field inspection.",
      hi: "‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§¶‡§ø‡§ñ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§â‡§ö‡§ø‡§§ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§î‡§∞ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç‡•§"
    };
  }

  return {
    en: "",
    hi: ""
  };
}
};

function applyLang() {
  document.getElementById("title").innerText = T[lang].title;
  document.getElementById("btnCorrect").innerText = T[lang].correct;
  document.getElementById("btnWrong").innerText = T[lang].wrong;
  document.getElementById("btnExpert").innerText = T[lang].expert;

  // toggle button text
  document.getElementById("langToggle").innerText = (lang === "en") ? "üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä" : "üåê English";
}

document.getElementById("langToggle").onclick = function() {
  lang = (lang === "en") ? "hi" : "en";
  applyLang();
};

// apply on load
applyLang();
    async function loadModel() {
      model = await tmImage.load("./model.json", "./metadata.json");
      modelReady = true;
      console.log("Model Loaded Successfully");
    }

    loadModel();

    document.getElementById("imageUpload").addEventListener("change", async function (event) {

      if (!modelReady) {
        alert("Model is still loading. Please wait a few seconds and try again.");
        return;
      }

      const file = event.target.files[0];
      const img = document.createElement("img");
      img.src = window.URL.createObjectURL(file);
      img.width = 300;

      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      preview.appendChild(img);

      img.onload = async () => {
        const prediction = await model.predict(img);
        prediction.sort((a, b) => b.probability - a.probability);

        const top = prediction[0];
        const confidence = top.probability * 100;
        

const warningEl = document.getElementById("warning");
warningEl.style.display = "none";
warningEl.innerText = "";
document.getElementById("btnExpert").classList.remove("low-confidence");
        const treatmentData = getTreatment(top.className);
document.getElementById("treatment").innerText = treatmentData[lang];

if (confidence < 70) {
  warningEl.style.display = "block";
 warningEl.innerText = T[lang].lowConf;
  document.getElementById("btnExpert").classList.add("low-confidence");
}
lastPrediction = top;
        document.getElementById("btnExpert").onclick = function() {
  window.open("https://wa.me/919999955233?text=" + encodeURIComponent(
    "Sugarcane AI: " + lastPrediction.className + " (" + (lastPrediction.probability*100).toFixed(2) + "%)"
  ), "_blank");
};
document.getElementById("actions").style.display = "block";

document.getElementById("btnCorrect").onclick = function() {
  openFeedbackForm("Yes");
};

document.getElementById("btnWrong").onclick = function() {
  openFeedbackForm("No");
};
        document.getElementById("result").innerText =
         T[lang].predPrefix +
          top.className +
          " (" +
          confidence.toFixed(2) +
          "%)";
      };
    });
    function openFeedbackForm(correctValue) {
  if (!lastPrediction) return;

  const disease = encodeURIComponent(lastPrediction.className);
  const conf = encodeURIComponent((lastPrediction.probability * 100).toFixed(2));
  const correct = encodeURIComponent(correctValue);

  const url =
    FORM_BASE +
    "&entry.1340582940=" + disease +
    "&entry.432078826=" + conf +
    "&entry.2027263940=" + correct;

  window.open(url, "_blank");
}
  </script>

</body>
</html>
